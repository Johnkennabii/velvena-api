{
    "/contracts/{id}/generate-signature": {
        "post": {
            "tags": ["Contracts"],
            "summary": "Generate and send an electronic signature link by email",
            "description": "This endpoint generates a new unique, expirable signature link for a specific contract and automatically emails it to the associated customer using the SMTP configuration defined in environment variables (`SMTP_HOST`, `SMTP_USER`, etc.). The link is valid for **7 days** from generation and can be used by the customer to sign their contract electronically.",
            "operationId": "generateContractSignatureLink",
            "parameters": [
                {
                    "name": "id",
                    "in": "path",
                    "required": true,
                    "schema": {
                        "type": "string",
                        "format": "uuid",
                        "example": "a7b2c3d4-5678-90ab-cdef-1234567890ab"
                    },
                    "description": "The unique identifier (`id`) of the contract for which to generate a signature link."
                }
            ],
            "responses": {
                "200": {
                    "description": "‚úÖ Signature link successfully generated and email sent to the customer.",
                    "content": {
                        "application/json": {
                            "examples": {
                                "success": {
                                    "summary": "Successful generation and email delivery",
                                    "value": {
                                        "success": true,
                                        "data": {
                                            "id": "1a3f5d8e-4b12-4e3a-9f92-18b44b69a4a7",
                                            "contract_id": "a7b2c3d4-5678-90ab-cdef-1234567890ab",
                                            "customer_id": "b8f5d33c-14a4-42e5-bd6a-51de7f2e123f",
                                            "token": "bba5d9f1-46e4-41b4-8157-8db68bff1f03",
                                            "expires_at": "2025-10-12T14:35:00.000Z"
                                        },
                                        "link": "https://app.allure-creation.fr/sign/bba5d9f1-46e4-41b4-8157-8db68bff1f03",
                                        "emailSentTo": "client@example.com"
                                    }
                                }
                            },
                            "schema": {
                                "type": "object",
                                "required": ["success", "data", "link", "emailSentTo"],
                                "properties": {
                                    "success": {
                                        "type": "boolean",
                                        "example": true
                                    },
                                    "data": {
                                        "type": "object",
                                        "description": "Information about the newly created signature link",
                                        "properties": {
                                            "id": {
                                                "type": "string",
                                                "format": "uuid",
                                                "description": "Unique identifier of the signature record"
                                            },
                                            "contract_id": {
                                                "type": "string",
                                                "format": "uuid",
                                                "description": "The ID of the related contract"
                                            },
                                            "customer_id": {
                                                "type": "string",
                                                "format": "uuid",
                                                "description": "The ID of the associated customer"
                                            },
                                            "token": {
                                                "type": "string",
                                                "description": "Unique secure token used to access the signing link"
                                            },
                                            "expires_at": {
                                                "type": "string",
                                                "format": "date-time",
                                                "description": "Date and time when the signing link will expire (7 days after creation)."
                                            }
                                        }
                                    },
                                    "link": {
                                        "type": "string",
                                        "format": "uri",
                                        "example": "https://app.allure-creation.fr/sign/6a3c12f4-2b8e-49a5-a3f4-901b2c1eab67",
                                        "description": "The full URL of the signing page the customer can access to sign the contract."
                                    },
                                    "emailSentTo": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "client@example.com",
                                        "description": "Email address where the signing link was sent."
                                    }
                                }
                            }
                        }
                    }
                },
                "400": {
                    "description": "‚ö†Ô∏è Invalid request or missing customer data.",
                    "content": {
                        "application/json": {
                            "examples": {
                                "missingId": {
                                    "summary": "Contract ID not provided",
                                    "value": { "success": false, "error": "Contract ID is required" }
                                },
                                "missingCustomer": {
                                    "summary": "Contract exists but no associated email",
                                    "value": { "success": false, "error": "Missing customer information" }
                                }
                            }
                        }
                    }
                },
                "404": {
                    "description": "‚ùå The specified contract was not found in the database.",
                    "content": {
                        "application/json": {
                            "example": { "success": false, "error": "Contract not found" }
                        }
                    }
                },
                "500": {
                    "description": "üí• Internal server error ‚Äî could not generate link or send email.",
                    "content": {
                        "application/json": {
                            "examples": {
                                "internalError": {
                                    "summary": "Unexpected server error",
                                    "value": { "success": false, "error": "Failed to generate sign link" }
                                }
                            }
                        }
                    }
                }
            },
            "security": [
                {
                    "bearerAuth": []
                }
            ]
        }
    }
}
